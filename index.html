<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Gravity Flip - Free HTML5 Game</title>
<meta name="description" content="Play Gravity Flip - Tap to flip gravity up/down while dodging obstacles from both sides. Collect stars for bonus points. Obstacles speed up gradually.">
<meta name="theme-color" content="#0a0a1a">
<meta property="og:type" content="website">
<meta property="og:title" content="Gravity Flip - Free HTML5 Game">
<meta property="og:description" content="Play Gravity Flip - Tap to flip gravity up/down while dodging obstacles from both sides. Collect stars for bonus points. Obstacles speed up gradually.">
<meta property="og:url" content="https://balinti.github.io/gravity-flip/">
<meta property="og:image" content="https://balinti.github.io/gravity-flip/og.png">
<link rel="preconnect" href="https://pagead2.googlesyndication.com">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4099346100621490" crossorigin="anonymous"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#0a0a1a;font-family:'Segoe UI',system-ui,-apple-system,sans-serif;touch-action:none;user-select:none;-webkit-user-select:none}
#wrap{position:relative;width:100%;max-width:420px;height:100%;max-height:750px;margin:0 auto;top:50%;transform:translateY(-50%)}
canvas{display:block;width:100%;height:100%}
#overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10;pointer-events:none;transition:opacity .3s}
#overlay.active{pointer-events:auto}
#overlay.hidden{opacity:0;pointer-events:none}
.panel{text-align:center;color:#fff;padding:24px}
.panel h1{font-size:38px;font-weight:800;letter-spacing:2px;margin-bottom:8px;text-shadow:0 0 30px rgba(120,200,255,.5)}
.panel .sub{font-size:15px;opacity:.7;margin-bottom:28px}
.panel .tap{font-size:18px;opacity:.85;animation:pulse 1.6s ease-in-out infinite}
.panel .score-display{font-size:52px;font-weight:800;margin:10px 0}
.panel .best-display{font-size:16px;opacity:.65;margin-bottom:22px}
@keyframes pulse{0%,100%{opacity:.6;transform:scale(1)}50%{opacity:1;transform:scale(1.05)}}
</style>
</head>
<body>
<div id="wrap">
<canvas id="c"></canvas>
<div id="overlay" class="active">
<div class="panel" id="startPanel">
<h1>GRAVITY FLIP</h1>
<div class="sub">Gate Rush</div>
<div class="tap">Tap to Start</div>
</div>
<div class="panel" id="overPanel" style="display:none">
<div class="sub">GAME OVER</div>
<div class="score-display" id="finalScore">0</div>
<div class="best-display" id="bestScore">Best: 0</div>
<div class="tap">Tap to Retry</div>
</div>
</div>
</div>
<script>
(function(){
"use strict";

const W=420,H=750;
const Y_TOP=140,Y_BOT=610;
const PLAYER_R=14,PLAYER_X=110;
const FLIP_DUR=0.18;
const FLIP_BULGE=34;
const LS_KEY='gfg_highscore_v1';
const NEAR_MISS_PX=18;

const cvs=document.getElementById('c');
const ctx=cvs.getContext('2d');
const wrap=document.getElementById('wrap');
const overlay=document.getElementById('overlay');
const startPanel=document.getElementById('startPanel');
const overPanel=document.getElementById('overPanel');
const finalScoreEl=document.getElementById('finalScore');
const bestScoreEl=document.getElementById('bestScore');

let dpr=Math.min(window.devicePixelRatio||1,2);
function resize(){
  const rect=wrap.getBoundingClientRect();
  cvs.width=W*dpr;
  cvs.height=H*dpr;
  cvs.style.width=rect.width+'px';
  cvs.style.height=rect.height+'px';
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
window.addEventListener('resize',resize);

let audioCtx=null;
function initAudio(){if(!audioCtx)try{audioCtx=new(window.AudioContext||window.webkitAudioContext)()}catch(e){}}
function beep(freq,dur,vol,type){
  if(!audioCtx)return;
  try{
    const o=audioCtx.createOscillator(),g=audioCtx.createGain();
    o.type=type||'square';o.frequency.value=freq;
    g.gain.value=vol||0.08;
    g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+dur);
    o.connect(g);g.connect(audioCtx.destination);
    o.start();o.stop(audioCtx.currentTime+dur);
  }catch(e){}
}
function sndFlip(){beep(520,0.08,0.07,'sine')}
function sndOrb(){beep(880,0.12,0.06,'sine')}
function sndGate(){beep(440,0.06,0.04,'triangle')}
function sndDeath(){beep(120,0.35,0.1,'sawtooth')}
function sndNearMiss(){beep(660,0.06,0.05,'sine')}

let state='start';
let t=0,score=0;
let best=parseInt(localStorage.getItem(LS_KEY))||0;
let player,gates,orbs,particles,popups;
let multMeter,multTier;
let shakeT=0,shakeMag=0,hitStopT=0;
let lastGateSpawn,lastOrbSpawn;
let baseHue=200;

function initState(){
  player={y:Y_BOT,onTop:false,flipping:false,flipT:0,flipFrom:0,flipTo:0};
  gates=[];orbs=[];particles=[];popups=[];
  multMeter=0;multTier=1;
  shakeT=0;shakeMag=0;hitStopT=0;
  lastGateSpawn=-1;lastOrbSpawn=-1;
  t=0;score=0;
}
initState();

function clamp(v,lo,hi){return v<lo?lo:v>hi?hi:v}
function lerp(a,b,u){return a+(b-a)*u}
function spd(){return 240+2.2*t+18*Math.log2(1+t/12)}
function gateInt(){return clamp(0.62-0.0025*t,0.34,0.62)}
function orbInt(){return clamp(1.10-0.002*t,0.55,1.10)}
function pulseP(){return clamp(1.20-0.002*t,0.85,1.20)}
function pulseD(){return clamp(0.42-0.0015*t,0.26,0.42)}
function rand(a,b){return a+Math.random()*(b-a)}
function hsl(h,s,l,a){return a!==undefined?'hsla('+((h|0)+360)%360+','+s+'%,'+l+'%,'+a+')':'hsl('+((h|0)+360)%360+','+s+'%,'+l+'%)'}

const MAX_P=260;
function emitP(x,y,vx,vy,sz,col,life){
  if(particles.length>=MAX_P){
    for(let i=0;i<particles.length;i++){
      if(particles[i].life<=0){particles[i]={x,y,vx,vy,sz,col,life,ml:life};return}
    }
    return;
  }
  particles.push({x,y,vx,vy,sz,col,life,ml:life});
}
function emitBurst(x,y,n,s,col){
  for(let i=0;i<n;i++){
    const a=Math.random()*Math.PI*2,sp=rand(s*0.3,s);
    emitP(x,y,Math.cos(a)*sp,Math.sin(a)*sp,rand(2,5),col,rand(0.3,0.7));
  }
}
function emitFlipTrail(){
  const col=hsl((baseHue+60)%360,80,65,0.8);
  emitP(PLAYER_X,player.y,rand(-20,20),rand(-30,30),rand(2,4),col,rand(0.15,0.35));
  emitP(PLAYER_X,player.y,rand(-20,20),rand(-30,30),rand(2,4),col,rand(0.15,0.35));
}
function emitOrbSpiral(x,y){
  for(let i=0;i<12;i++){
    const a=i/12*Math.PI*2,s=rand(60,140);
    emitP(x,y,Math.cos(a)*s,Math.sin(a)*s,rand(2,4),hsl((baseHue+120)%360,90,70,0.9),rand(0.3,0.5));
  }
}

function addPopup(x,y,txt,col){popups.push({x,y,txt,col,life:0.8,ml:0.8})}

function pickGate(){
  let wo,wp,wpu;
  if(t<10){wo=0.75;wp=0.25;wpu=0}
  else if(t<30){wo=0.45;wp=0.35;wpu=0.20}
  else{wo=0.30;wp=0.35;wpu=0.35}
  const r=Math.random();
  return r<wo?'open':r<wo+wp?'polarity':'pulse';
}

function createGate(type){
  const g={x:W+60,type,w:36,passed:false,scored:false};
  if(type==='polarity')g.safeRail=Math.random()<0.5?'top':'bottom';
  if(type==='pulse')g.phase=Math.random()*Math.PI*2;
  return g;
}

function isFair(ng){
  if(ng.type!=='polarity')return true;
  for(let i=gates.length-1;i>=0;i--){
    const g=gates[i];
    if(g.type==='polarity'&&g.safeRail!==ng.safeRail){
      if(ng.x-g.x<spd()*FLIP_DUR*1.8)return false;
    }
  }
  return true;
}

function circCirc(x1,y1,r1,x2,y2,r2){
  const dx=x1-x2,dy=y1-y2;return dx*dx+dy*dy<(r1+r2)*(r1+r2);
}
function pRail(){return player.y<H/2?'top':'bottom'}
function isPulseSafe(g){
  const per=pulseP(),du=pulseD();
  return((t+g.phase)%per)/per<du;
}

function doFlip(){
  if(player.flipping)return;
  player.flipping=true;player.flipT=0;
  player.flipFrom=player.y;
  player.flipTo=player.onTop?Y_BOT:Y_TOP;
  player.onTop=!player.onTop;
  if(multMeter>0.15){multMeter=Math.max(0,multMeter-0.22)}
  else{multTier=Math.max(1,multTier-1);multMeter=0}
  sndFlip();
}

function handleInput(e){
  e.preventDefault();initAudio();
  if(state==='start')startGame();
  else if(state==='playing')doFlip();
  else if(state==='gameover'&&hitStopT<=0)startGame();
}
document.addEventListener('pointerdown',handleInput);
document.addEventListener('keydown',function(e){
  if(e.code==='Space'||e.code==='Enter')handleInput(e);
});

function startGame(){
  state='playing';
  overlay.classList.remove('active');overlay.classList.add('hidden');
  startPanel.style.display='none';overPanel.style.display='none';
  initState();
}

function gameOver(){
  state='gameover';sndDeath();
  shakeT=0.25;shakeMag=10;hitStopT=0.20;
  if(score>best){best=score;localStorage.setItem(LS_KEY,best)}
  finalScoreEl.textContent=score;
  bestScoreEl.textContent='Best: '+best;
}

function showOverUI(){
  overPanel.style.display='';startPanel.style.display='none';
  overlay.classList.remove('hidden');overlay.classList.add('active');
}

let lastTime=0;
function loop(now){
  requestAnimationFrame(loop);
  const raw=(now-lastTime)/1000;lastTime=now;
  const dt=Math.min(raw,0.05);

  if(state==='start'){drawStart(dt);return}
  if(hitStopT>0){hitStopT-=dt;if(hitStopT<=0&&state==='gameover')showOverUI();drawFrame(0);return}
  if(state==='gameover'){drawFrame(0);return}
  update(dt);drawFrame(dt);
}

function update(dt){
  t+=dt;
  baseHue=(t*22+multTier*18)%360;
  const sp=spd();

  if(player.flipping){
    player.flipT+=dt;
    const u=clamp(player.flipT/FLIP_DUR,0,1);
    const ease=0.5-0.5*Math.cos(Math.PI*u);
    const baseY=lerp(player.flipFrom,player.flipTo,ease);
    const bulgeDir=player.flipTo<player.flipFrom?-1:1;
    player.y=baseY+FLIP_BULGE*Math.sin(Math.PI*u)*(-bulgeDir);
    emitFlipTrail();
    if(u>=1){player.flipping=false;player.y=player.flipTo}
  }

  lastGateSpawn+=dt;
  if(lastGateSpawn>=gateInt()||lastGateSpawn<0){
    const type=pickGate();
    const g=createGate(type);
    if(isFair(g)){gates.push(g);lastGateSpawn=0}
  }

  lastOrbSpawn+=dt;
  if(lastOrbSpawn>=orbInt()||lastOrbSpawn<0){
    const o={x:W+30,y:Math.random()<0.5?Y_TOP:Y_BOT,r:10,collected:false};
    let ok=true;
    for(const g of gates){if(Math.abs(g.x-o.x)<120){ok=false;break}}
    if(ok){orbs.push(o);lastOrbSpawn=0}
  }

  for(let i=gates.length-1;i>=0;i--){
    const g=gates[i];g.x-=sp*dt;
    if(g.x<-80){gates.splice(i,1);continue}

    const gL=g.x-g.w/2,gR=g.x+g.w/2;
    if(!g.scored&&PLAYER_X+PLAYER_R>gL&&PLAYER_X-PLAYER_R<gR){
      const rail=pRail();let dead=false;
      if(g.type==='polarity'&&rail!==g.safeRail)dead=true;
      if(g.type==='pulse'&&!isPulseSafe(g))dead=true;

      if(dead){emitBurst(PLAYER_X,player.y,30,200,hsl(0,90,60));gameOver();return}

      g.scored=true;
      let pts=g.type==='open'?1*multTier:g.type==='polarity'?2*multTier:3*multTier;
      score+=pts;sndGate();
      emitBurst(g.x,H/2,8,80,hsl(baseHue,80,65));
      addPopup(g.x,H/2-40,'+'+pts,hsl(baseHue,80,75));
    }

    if(!g.passed&&g.x+g.w/2<PLAYER_X-PLAYER_R){
      g.passed=true;
      if(g.type==='polarity'){
        const safeY=g.safeRail==='top'?Y_TOP:Y_BOT;
        if(Math.abs(player.y-safeY)<NEAR_MISS_PX){
          score+=2;multMeter=Math.min(1,multMeter+0.06);
          shakeT=0.10;shakeMag=4;sndNearMiss();
          addPopup(PLAYER_X+30,player.y-20,'CLOSE!','#fff');
        }
      }
      if(g.type==='open'){
        const dT=Math.abs(player.y-Y_TOP),dB=Math.abs(player.y-Y_BOT);
        const md=Math.min(dT,dB);
        if(md>PLAYER_R&&md<PLAYER_R+NEAR_MISS_PX){
          score+=2;multMeter=Math.min(1,multMeter+0.06);
          shakeT=0.10;shakeMag=4;sndNearMiss();
          addPopup(PLAYER_X+30,player.y-20,'CLOSE!','#fff');
        }
      }
    }
  }

  for(let i=orbs.length-1;i>=0;i--){
    const o=orbs[i];o.x-=sp*dt;
    if(o.x<-40){orbs.splice(i,1);continue}
    if(!o.collected&&circCirc(PLAYER_X,player.y,PLAYER_R,o.x,o.y,o.r)){
      o.collected=true;sndOrb();
      multMeter+=0.18;
      if(multMeter>=1){multTier++;multMeter-=1}
      emitOrbSpiral(o.x,o.y);
      addPopup(o.x,o.y-20,'+ORB',hsl((baseHue+120)%360,90,70));
      orbs.splice(i,1);
    }
  }

  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];p.life-=dt;
    if(p.life<=0){particles.splice(i,1);continue}
    p.x+=p.vx*dt;p.y+=p.vy*dt;p.vy+=200*dt;
  }

  for(let i=popups.length-1;i>=0;i--){
    const p=popups[i];p.life-=dt;p.y-=50*dt;
    if(p.life<=0)popups.splice(i,1);
  }

  if(shakeT>0)shakeT-=dt;
}

function drawFrame(dt){
  ctx.save();
  let sx=0,sy=0;
  if(shakeT>0){
    sx=(Math.random()-0.5)*2*shakeMag;
    sy=(Math.random()-0.5)*2*shakeMag;
    ctx.translate(sx,sy);
  }

  const bg1=hsl((baseHue+200)%360,30,8);
  const bg2=hsl((baseHue+220)%360,25,14);
  const grad=ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,bg1);grad.addColorStop(1,bg2);
  ctx.fillStyle=grad;ctx.fillRect(-20,-20,W+40,H+40);

  ctx.fillStyle=hsl(baseHue,20,6,0.5);
  ctx.fillRect(0,0,W,Y_TOP-4);
  ctx.fillRect(0,Y_BOT+4,W,H-Y_BOT-4);

  const railCol=hsl(baseHue,40,30,0.6);
  ctx.fillStyle=railCol;
  ctx.fillRect(0,Y_TOP-4,W,8);ctx.fillRect(0,Y_BOT-4,W,8);

  for(const g of gates)drawGate(g);

  for(const o of orbs){
    if(o.collected)continue;
    const oh=(baseHue+120)%360;
    ctx.fillStyle=hsl(oh,90,65);ctx.shadowColor=hsl(oh,90,65);ctx.shadowBlur=12;
    ctx.beginPath();ctx.arc(o.x,o.y,o.r,0,Math.PI*2);ctx.fill();
    ctx.shadowBlur=0;
    ctx.fillStyle=hsl(oh,90,85,0.6);
    ctx.beginPath();ctx.arc(o.x,o.y,o.r*0.5,0,Math.PI*2);ctx.fill();
  }

  if(player.flipping){
    ctx.fillStyle=hsl(baseHue,70,60,0.2);
    ctx.beginPath();ctx.arc(PLAYER_X-8,lerp(player.flipFrom,player.flipTo,0.3),PLAYER_R*0.7,0,Math.PI*2);ctx.fill();
    ctx.fillStyle=hsl(baseHue,70,60,0.12);
    ctx.beginPath();ctx.arc(PLAYER_X-16,lerp(player.flipFrom,player.flipTo,0.15),PLAYER_R*0.5,0,Math.PI*2);ctx.fill();
  }

  ctx.fillStyle=hsl(baseHue,80,60);ctx.shadowColor=hsl(baseHue,80,60);ctx.shadowBlur=16;
  ctx.beginPath();ctx.arc(PLAYER_X,player.y,PLAYER_R,0,Math.PI*2);ctx.fill();
  ctx.shadowBlur=0;
  ctx.fillStyle=hsl(baseHue,60,80,0.7);
  ctx.beginPath();ctx.arc(PLAYER_X,player.y,PLAYER_R*0.55,0,Math.PI*2);ctx.fill();

  for(const p of particles){
    if(p.life<=0)continue;
    ctx.globalAlpha=clamp(p.life/p.ml,0,1);
    ctx.fillStyle=p.col;
    ctx.fillRect(p.x-p.sz/2,p.y-p.sz/2,p.sz,p.sz);
  }
  ctx.globalAlpha=1;

  ctx.font='bold 16px "Segoe UI",system-ui,sans-serif';ctx.textAlign='center';
  for(const p of popups){
    ctx.globalAlpha=clamp(p.life/p.ml,0,1);
    ctx.fillStyle=p.col;ctx.fillText(p.txt,p.x,p.y);
  }
  ctx.globalAlpha=1;

  drawHUD();
  ctx.restore();
}

function drawGate(g){
  const gx=g.x,hw=g.w/2;
  if(g.type==='open'){
    ctx.fillStyle=hsl(120,60,45,0.7);
    ctx.fillRect(gx-hw,Y_TOP-4,g.w,20);
    ctx.fillRect(gx-hw,Y_BOT-16,g.w,20);
    ctx.strokeStyle=hsl(120,50,50,0.3);ctx.lineWidth=1;
    ctx.setLineDash([4,4]);
    ctx.beginPath();ctx.moveTo(gx,Y_TOP+16);ctx.lineTo(gx,Y_BOT-16);ctx.stroke();
    ctx.setLineDash([]);
  }else if(g.type==='polarity'){
    if(g.safeRail==='top'){
      ctx.fillStyle=hsl(0,80,50,0.8);drawSpikes(gx-hw,Y_BOT-28,g.w,28,false);
      ctx.fillStyle=hsl(120,70,50,0.7);ctx.fillRect(gx-hw,Y_TOP-4,g.w,16);
    }else{
      ctx.fillStyle=hsl(0,80,50,0.8);drawSpikes(gx-hw,Y_TOP+4,g.w,28,true);
      ctx.fillStyle=hsl(120,70,50,0.7);ctx.fillRect(gx-hw,Y_BOT-12,g.w,16);
    }
    ctx.fillStyle='rgba(255,255,255,0.6)';ctx.font='bold 14px sans-serif';ctx.textAlign='center';
    ctx.fillText(g.safeRail==='top'?'\u25B2':'\u25BC',gx,g.safeRail==='top'?Y_TOP+30:Y_BOT-30);
  }else if(g.type==='pulse'){
    const safe=isPulseSafe(g);
    if(!safe){
      ctx.fillStyle=hsl(0,80,55,0.8);
      ctx.fillRect(gx-hw,Y_TOP+4,g.w,Y_BOT-Y_TOP-8);
      ctx.fillStyle=hsl(0,90,40,0.4);
      for(let yy=Y_TOP+10;yy<Y_BOT-10;yy+=24)ctx.fillRect(gx-hw+4,yy,g.w-8,8);
    }else{
      ctx.strokeStyle=hsl(120,60,50,0.5);ctx.lineWidth=2;
      ctx.strokeRect(gx-hw,Y_TOP+4,g.w,Y_BOT-Y_TOP-8);
    }
    ctx.fillStyle=safe?hsl(120,80,60):hsl(0,90,55);
    ctx.beginPath();ctx.arc(gx,Y_TOP-14,4,0,Math.PI*2);ctx.fill();
    ctx.beginPath();ctx.arc(gx,Y_BOT+14,4,0,Math.PI*2);ctx.fill();
  }
}

function drawSpikes(x,y,w,h,pd){
  const n=4,sw=w/n;ctx.beginPath();
  for(let i=0;i<n;i++){
    const lx=x+i*sw;
    if(pd){ctx.moveTo(lx,y);ctx.lineTo(lx+sw/2,y+h);ctx.lineTo(lx+sw,y)}
    else{ctx.moveTo(lx,y+h);ctx.lineTo(lx+sw/2,y);ctx.lineTo(lx+sw,y+h)}
  }
  ctx.fill();
}

function drawHUD(){
  ctx.fillStyle='rgba(255,255,255,0.9)';ctx.font='bold 22px "Segoe UI",system-ui,sans-serif';
  ctx.textAlign='left';ctx.fillText(score,20,40);
  ctx.font='14px "Segoe UI",system-ui,sans-serif';ctx.textAlign='right';
  ctx.fillStyle='rgba(255,255,255,0.5)';ctx.fillText('BEST '+best,W-20,40);
  ctx.textAlign='left';ctx.font='bold 14px "Segoe UI",system-ui,sans-serif';
  ctx.fillStyle=hsl((baseHue+60)%360,70,65);ctx.fillText(multTier+'x',20,70);
  const bx=50,by=60,bw=80,bh=8;
  ctx.fillStyle='rgba(255,255,255,0.15)';ctx.fillRect(bx,by,bw,bh);
  ctx.fillStyle=hsl((baseHue+60)%360,70,55,0.8);ctx.fillRect(bx,by,bw*multMeter,bh);
  ctx.strokeStyle='rgba(255,255,255,0.3)';ctx.lineWidth=1;ctx.strokeRect(bx,by,bw,bh);
}

let startAnim=0;
function drawStart(dt){
  startAnim+=dt;baseHue=(startAnim*15)%360;
  ctx.save();
  const grad=ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,hsl((baseHue+200)%360,30,8));
  grad.addColorStop(1,hsl((baseHue+220)%360,25,14));
  ctx.fillStyle=grad;ctx.fillRect(0,0,W,H);
  ctx.fillStyle=hsl(baseHue,40,30,0.4);
  ctx.fillRect(0,Y_TOP-4,W,8);ctx.fillRect(0,Y_BOT-4,W,8);
  const dx=W/2+Math.sin(startAnim*1.5)*60,dy=H/2+Math.cos(startAnim*2)*40;
  ctx.fillStyle=hsl(baseHue,80,60,0.6);ctx.shadowColor=hsl(baseHue,80,60);ctx.shadowBlur=20;
  ctx.beginPath();ctx.arc(dx,dy,18,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;
  ctx.restore();
}

bestScoreEl.textContent='Best: '+best;
requestAnimationFrame(function init(now){lastTime=now;requestAnimationFrame(loop)});
})();
</script>
</body>
</html>